<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xiaofei.shop.dao.AdministratorDao">

    <resultMap id="adminMap1" type="Administrator">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="loginName" column="login_name"/>
        <result property="password" column="password"/>
        <result property="phone" column="phone"/>
        <result property="email" column="email"/>
        <result property="isValid" column="is_valid"/>
        <result property="createDate" column="create_date"/>
        <association property="role" javaType="Role" column="role_id">
            <id column="role_id" property="id"/>
        </association>
    </resultMap>

    <resultMap id="adminMap2" type="Administrator">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="loginName" column="login_name"/>
        <result property="password" column="password"/>
        <result property="phone" column="phone"/>
        <result property="email" column="email"/>
        <result property="isValid" column="is_valid"/>
        <result property="createDate" column="create_date"/>
        <association property="role" javaType="Role" column="role_id">
            <id column="roleId" property="id"/>
            <result column="roleName" property="name"/>
        </association>
    </resultMap>



    <sql id="adminColumn">id,name,login_name,password,phone,email,is_valid,create_date,role_id</sql>

    <sql id="adminFullColumn">
        a.id,
        a.name,
        a.login_name,
        a.password,
        a.phone,
        a.email,
        a.is_valid,
        a.create_date,
        r.id "roleId",
        r.name "roleName"
    </sql>

    <sql id="ifSql">
        <if test="name!=null and name!=''">
            and a.name=#{name}
        </if>
        <if test="loginName!=null and loginName!=''">
            and login_name=#{loginName}
        </if>
        <if test="phone!=null and phone!=''">
            and phone=#{phone}
        </if>
        <if test="isValid!=null and isValid!='-1'">
            and is_valid=#{isValid}
        </if>
        <if test="role!=null and role.id!='-1'">
            and role_id=#{role.id}
        </if>
    </sql>

    <insert id="saveAdmin" parameterType="Administrator" useGeneratedKeys="true" keyProperty="id">
        insert into administrators (name, login_name, password, phone, email, is_valid, create_date, role_id)
        values (#{name},#{loginName},#{password},#{phone},#{email},#{isValid},#{createDate},#{role.id})
    </insert>

    <delete id="deleteAdminById">
        delete from administrators
        where id=#{id}
    </delete>

    <update id="updateAdmin">
        update administrators set name=#{name},phone=#{phone},password=#{password},email=#{email},role_id=#{role.id}
        where id=#{id}
    </update>

    <update id="updateAdminStatus">
        update administrators set is_valid=#{isValid}
        where id=#{id}
    </update>

    <select id="getAdmins" resultMap="adminMap2">
        select <include refid="adminFullColumn"/>
        from administrators a
        left join roles r
        on a.role_id=r.id
    </select>

    <select id="getAdminById" resultMap="adminMap1">
        select <include refid="adminColumn"/>
        from administrators where id=#{id}
    </select>

    <select id="getAdminByParam" resultMap="adminMap2">
        select <include refid="adminFullColumn"/>
        from administrators a
        left join roles r on r.id = a.role_id
        where 1=1 <include refid="ifSql"/>
    </select>

    <select id="getAdminByAccName" resultMap="adminMap1">
        select <include refid="adminColumn"/>
        from administrators
        where login_name=#{loginName}
    </select>

    <select id="getAdminByName" resultMap="adminMap1">
        select <include refid="adminColumn"/>
        from administrators
        where name=#{name}
    </select>
    
    <select id="getAdminByCredential" resultMap="adminMap1">
        select <include refid="adminColumn"/>
        from administrators
        where
              login_name=#{loginName}
        and
              password=#{password}
    </select>

</mapper>